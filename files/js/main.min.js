$(document).ready(function() {

	$(window).on("load", function() {
		loadEnd();
	});

	setup();
});

function setup() {
	$('.fixed-scroll').css("position", "fixed");
	$("#content-container .parallax-wrapper.home-back").css("transform", "translateY(50%)");
	$("#content-container .nav-wrapper *").css("transform", "translateY(200%)");
	$("#content-container .parallax-wrapper.home-back img").css("transform", "translateY(-40%)");
	$("#content-container .h-animate").css("transform", "translateY(-200%)");
	$("#content-container .parallax-wrapper.home-back, #content-container .h-animate, #content-container .nav-wrapper *").css("opacity", "0");
	load();
}

function load() {
	$("#content-container .load .loader").css("opacity", "0");
	$("#content-container .load .loader").css("transform", "translateY(50px)");
	anime({
		targets: "#content-container .load .loader",
		opacity:1,
		translateY: "0",
		easing: "cubicBezier(0.23, 1, 0.32, 1)",
		duration: 1000,
		delay: 1000
	});
}

function loadEnd() {
	setTimeout(function() {
		anime({
			targets: "#content-container .load .loader",
			opacity:0,
			translateY: "-50px",
			duration: 1000,
			delay: 1000,
			easing: "cubicBezier(0.755, 0.05, 0.855, 0.06)",
			complete: function() {
				$("#content-container .load").css("display", "none");
				animateIn();
			}
		});
	}, 2000);
}

function animateIn() {
	anime({
		targets: "#content-container .nav-wrapper *",
		translateY: "0%",
		opacity: 1,
		easing: "cubicBezier(0.165, 0.84, 0.44, 1)",
		duration: 1500,
		delay: anime.stagger(200)
	})
	anime({
		targets: "#content-container .parallax-wrapper.home-back, #content-container .parallax-wrapper.home-back img",
		translateY: "0%",
		opacity:1,
		easing: "cubicBezier(0.165, 0.84, 0.44, 1)",
		duration: 1500,
		delay: 300
	});
	setTimeout(function() {
		anime({
			targets: "#content-container .h-animate",
			translateY: "0%",
			opacity:1,
			easing: "cubicBezier(0.165, 0.84, 0.44, 1)",
			duration: 1200,
			delay: anime.stagger(300),
			complete: function() {
				easeScroll();
				workListener();
			}
		});
	}, 300);
}

function workListener() {
	$(".list-item").click(function() {
		openItem(this);
	});

	function openItem(obj) {
		if ($(obj).data("msg")) {
			alert($(obj).data("msg"));
		}
		if ($(obj).data("ref")) {
			var win = window.open($(obj).data("ref"), '_blank');
			win.focus();
		} else {
			console.log("hello");
		}
		/*anime({
			targets: ".fixed-scroll",
			marginLeft: "10%",
			easing: "cubicBezier(0.86, 0, 0.07, 1)",
			duration: 800
		});
		anime({
			targets: "#listing-container .content-wrapper",
			paddingLeft: "7vw",
			easing: "cubicBezier(0.23, 1, 0.32, 1)",
			duration: 1050
		});
		anime({
			targets: "#listing-container",
			width: "100vw",
			easing: "cubicBezier(0.86, 0, 0.07, 1)",
			duration: 700
		});*/
	}
}

function animateScroll() {

	var animated = [];

	$(".list-item .w-animate, .a-animate").css("opacity", "0");
	$(".list-item .w-animate, .a-animate").css("transform", "translateY(50%)");

	function inView(elem) {
	  var docViewTop = $(window).scrollTop();
	  var docViewBottom = docViewTop + $(window).height();

	  var elemTop = $(elem).offset().top;
	  var elemBottom = elemTop + $(elem).height();

	  return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
	}

	function animate(el, i) {
		if (!animated.includes(el)) {
			animated.push(el);
			anime({
				targets: el,
				opacity:1,
				translateY: "0",
				easing: "cubicBezier(0.165, 0.84, 0.44, 1)",
				duration: 1000,
				delay: anime.stagger(300, {start: i*100})
			});
		}
	}

	$(window).scroll(function() {
		$('.list-item').each(function (index) {
	      if (inView(this)) {
					animate(".list-item:nth-child("+(index+1)+") .w-animate", index);
	      }
	  });
		if (inView("#content-container.about")) {
			animate("#content-container.about .a-animate", 0);
		}
	});
}

function easeScroll() {
	animateScroll();

	m.transitions.mntm_scroll(".fixed-scroll", [
		{element: ".parallax-wrapper", offsetY: 6},
		{element: ".fixed-scroll", offsetY: -1},
		{element: ".back-parallax-wrapper", offsetY: 4},
		{element: ".parallax-wrapper.about", offsetY: 4}
	], 1000, "cubic-bezier(0.19, 1, 0.22, 1)");
}
